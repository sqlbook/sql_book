<main>
  <div class="page-header">
    <div class="title">
      <h1>Query Library</h1>
      <%= link_to app_data_source_queries_path(@data_sources.first), class: "link secondary create-data-source", "data-shortcut": "N" do %>
        <i class="ri-add-line red-500"></i>
        <span>Create New</span>
      <% end %>
    </div>
    <div class="controls">
      <%= form_with url: app_queries_path, method: :get do |form| %>
        <%= form.text_field :search, type: "search", placeholder: "Search...", value: params[:search], class: "input block search" %>
      <% end %>
    </div>
  </div>

  <div class="queries-table">
    <table>
      <tr>
        <th>Name</th>
        <th>Data source</th>
        <th>Original author</th>
        <th>Date created</th>
        <th>Last updated</th>
        <th>Last updated by</th>
        <th>Last run</th>
      </tr>
      <% @queries.each do |query| %>
        <tr>
          <td>
            <%= link_to app_data_source_query_path(query.data_source, query), class: "link name cream-250" do %>
              <%= query.name %>
            <% end %>
          </td>
          <td><%= query.data_source.url %></td>
          <td><%= query.author.full_name %></td>
          <td><%= query.created_at.strftime('%a, %e %b %Y') %></td>
          <td><%= query.updated_at.strftime('%a, %e %b %Y') %></td>
          <td><%= query.last_updated_by&.full_name || '-' %></td>
          <td><%= query.last_run_at&.strftime('%a, %e %b %Y') || '-' %></td>
        </tr>
      <% end %>
    </table>
  </div>
</main>
